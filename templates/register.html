{% extends "base.html" %}

{% block title %}Register - Expense Management System{% endblock %}

{% block content %}
<!-- ***** Header Area Start ***** -->
<header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <!-- ***** Logo Start ***** -->
                    <a href="{{ url_for('landing') }}" class="logo" style="display: flex; align-items: center;">
                        <span style="font-size: 32px; font-weight: 700; color: #667eea;">ðŸ’° ExpenseFlow</span>
                    </a>
                    <!-- ***** Logo End ***** -->
                    <!-- ***** Menu Start ***** -->
                    <ul class="nav">
                        <li><a href="{{ url_for('landing') }}">Home</a></li>
                        <li><a href="{{ url_for('login') }}">Login</a></li>
                        <li><div class="gradient-button"><a href="{{ url_for('register') }}"><i class="fa fa-user-plus"></i> Sign Up</a></div></li> 
                    </ul>        
                    <a class='menu-trigger'>
                        <span>Menu</span>
                    </a>
                    <!-- ***** Menu End ***** -->
                </nav>
            </div>
        </div>
    </div>
</header>
<!-- ***** Header Area End ***** -->

<!-- ***** Register Section Start ***** -->
<div class="register-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2">
                <div class="register-form-container">
                    <div class="section-heading text-center">
                        <h4>Create Your <em>ExpenseFlow</em> Account</h4>
                        <img src="{{ url_for('static', filename='images/heading-line-dec.png') }}" alt="">
                        <p>Join thousands of businesses streamlining their expense management</p>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-7">
                            <div class="register-form">
                                <form action="{{ url_for('register') }}" method="POST" id="registerForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="name"><i class="fa fa-user"></i> Full Name</label>
                                                <input type="text" class="form-control" id="name" name="name" placeholder="Enter your full name" required>
                                                <small class="form-text text-muted">Your display name in the system</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="email"><i class="fa fa-envelope"></i> Email Address</label>
                                                <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email address" required>
                                                <small class="form-text text-muted">This will be your login username</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="country"><i class="fa fa-globe"></i> Country</label>
                                        <select class="form-control" id="country" name="country" required>
                                            <option value="">Select your country</option>
                                        </select>
                                        <small class="form-text text-muted">We'll set up your company with the local currency</small>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="password"><i class="fa fa-lock"></i> Password</label>
                                                <div class="password-input-group">
                                                    <input type="password" class="form-control" id="password" name="password" placeholder="Create a strong password" required>
                                                    <span class="password-toggle" onclick="togglePassword('password')">
                                                        <i class="fa fa-eye" id="password-eye"></i>
                                                    </span>
                                                </div>
                                                <div class="password-strength" id="password-strength"></div>
                                                <small class="form-text text-muted">At least 8 characters with mixed case, numbers & symbols</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="confirm_password"><i class="fa fa-lock"></i> Confirm Password</label>
                                                <div class="password-input-group">
                                                    <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirm your password" required>
                                                    <span class="password-toggle" onclick="togglePassword('confirm_password')">
                                                        <i class="fa fa-eye" id="confirm_password-eye"></i>
                                                    </span>
                                                </div>
                                                <div class="password-match" id="password-match"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="role"><i class="fa fa-briefcase"></i> Your Role</label>
                                        <select class="form-control" id="role" name="role" required>
                                            <option value="">Select your role</option>
                                            <option value="Admin">Admin - Full system access</option>
                                            <option value="Manager">Manager - Team management</option>
                                            <option value="Employee">Employee - Submit expenses</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="terms" required>
                                            <label class="form-check-label" for="terms">
                                                I agree to the <a href="#" class="terms-link">Terms of Service</a> and <a href="#" class="terms-link">Privacy Policy</a>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="newsletter">
                                            <label class="form-check-label" for="newsletter">
                                                Send me updates about new features and expense management tips
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <button type="submit" class="gradient-button full-width" id="registerBtn">
                                            <i class="fa fa-user-plus"></i> Create Account
                                        </button>
                                    </div>
                                </form>
                                
                                <div class="register-footer">
                                    <p>Already have an account? <a href="{{ url_for('login') }}" class="login-link">Sign in here</a></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-5">
                            <div class="register-image">
                                <img src="{{ url_for('static', filename='vendor/undraw_spreadsheets_bh6n-removebg-preview.png') }}" alt="Expense Management" class="register-illustration">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ***** Register Section End ***** -->

<!-- ***** Footer Start ***** -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <p>Copyright Â© 2025 ExpenseFlow Co., Ltd. All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

<style>
.register-section {
    padding: 120px 0 80px 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.register-form-container {
    background: rgba(255, 255, 255, 0.95);
    padding: 60px;
    border-radius: 20px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
}

.register-form .form-group {
    margin-bottom: 25px;
}

.register-form label {
    color: #333;
    font-weight: 600;
    margin-bottom: 8px;
    display: block;
}

.register-form .form-control {
    padding: 15px 20px;
    border: 2px solid #e1e1e1;
    border-radius: 10px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: white;
}

.register-form .form-control:focus {
    border-color: #667eea;
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.password-input-group {
    position: relative;
}

.password-toggle {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #666;
}

.password-strength {
    margin-top: 5px;
    height: 4px;
    border-radius: 2px;
    transition: all 0.3s ease;
}

.strength-weak { background: #ff4757; }
.strength-medium { background: #ffa502; }
.strength-strong { background: #2ed573; }

.password-match {
    margin-top: 5px;
    font-size: 0.85rem;
}

.match-success { color: #2ed573; }
.match-error { color: #ff4757; }

.form-text {
    color: #666;
    font-size: 0.85rem;
    margin-top: 5px;
}

.terms-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
}

.terms-link:hover {
    text-decoration: underline;
}

.gradient-button.full-width {
    width: 100%;
    text-align: center;
    padding: 15px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.gradient-button.full-width:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

.register-footer {
    text-align: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e1e1e1;
}

.login-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
}

.login-link:hover {
    text-decoration: underline;
}

.register-image {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    padding: 30px;
}

.register-illustration {
    max-width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: contain;
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.1));
}

@media (max-width: 768px) {
    .register-form-container {
        padding: 40px 20px;
    }
    
    .register-image {
        padding: 20px;
        margin-top: 30px;
    }
    
    .register-illustration {
        max-height: 300px;
    }
}
</style>

<script>
// Load countries from API
document.addEventListener('DOMContentLoaded', function() {
    loadCountries();
    setupPasswordValidation();
});

function loadCountries() {
    fetch('/api/countries')
    .then(response => response.json())
    .then(countries => {
        const select = document.getElementById('country');
        
        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country.name;
            option.textContent = `${country.name} (${country.currencies.map(c => c.code).join(', ')})`;
            select.appendChild(option);
        });
    })
    .catch(error => {
        console.error('Error loading countries:', error);
        // Fallback to common countries
        const commonCountries = [
            'Afghanistan', 'Albania', 'Algeria', 'Argentina', 'Australia', 'Austria', 'Bangladesh', 'Belgium', 'Brazil', 'Canada',
            'China', 'Denmark', 'Egypt', 'Finland', 'France', 'Germany', 'Ghana', 'Greece', 'India', 'Indonesia',
            'Ireland', 'Italy', 'Japan', 'Kenya', 'Malaysia', 'Mexico', 'Netherlands', 'Nigeria', 'Norway', 'Pakistan',
            'Philippines', 'Poland', 'Portugal', 'Russia', 'Saudi Arabia', 'Singapore', 'South Africa', 'South Korea',
            'Spain', 'Sweden', 'Switzerland', 'Thailand', 'Turkey', 'Ukraine', 'United Kingdom', 'United States', 'Vietnam'
        ];
        
        const select = document.getElementById('country');
        commonCountries.forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.textContent = country;
            select.appendChild(option);
        });
    });
}

function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const eye = document.getElementById(fieldId + '-eye');
    
    if (field.type === 'password') {
        field.type = 'text';
        eye.className = 'fa fa-eye-slash';
    } else {
        field.type = 'password';
        eye.className = 'fa fa-eye';
    }
}

function setupPasswordValidation() {
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    const strengthDiv = document.getElementById('password-strength');
    const matchDiv = document.getElementById('password-match');
    
    password.addEventListener('input', function() {
        const strength = checkPasswordStrength(this.value);
        strengthDiv.className = `password-strength strength-${strength.level}`;
        strengthDiv.style.width = `${strength.percentage}%`;
    });
    
    confirmPassword.addEventListener('input', function() {
        if (this.value === '') {
            matchDiv.textContent = '';
            matchDiv.className = 'password-match';
        } else if (this.value === password.value) {
            matchDiv.textContent = 'âœ“ Passwords match';
            matchDiv.className = 'password-match match-success';
        } else {
            matchDiv.textContent = 'âœ— Passwords do not match';
            matchDiv.className = 'password-match match-error';
        }
    });
}

function checkPasswordStrength(password) {
    let score = 0;
    
    if (password.length >= 8) score++;
    if (password.match(/[a-z]/)) score++;
    if (password.match(/[A-Z]/)) score++;
    if (password.match(/[0-9]/)) score++;
    if (password.match(/[^a-zA-Z0-9]/)) score++;
    
    if (score < 3) return { level: 'weak', percentage: 33 };
    if (score < 5) return { level: 'medium', percentage: 66 };
    return { level: 'strong', percentage: 100 };
}

// Form validation
document.getElementById('registerForm').addEventListener('submit', function(e) {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match!');
        return false;
    }
    
    if (password.length < 8) {
        e.preventDefault();
        alert('Password must be at least 8 characters long!');
        return false;
    }
    
    // Show loading state
    const btn = document.getElementById('registerBtn');
    btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Creating Account...';
    btn.disabled = true;
});
</script>
{% endblock %}